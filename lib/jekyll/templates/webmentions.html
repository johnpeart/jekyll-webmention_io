{% capture webmention_types %}{{ types | join: ',' }}{% endcapture %}

{%- if html_proofer_ignore == "all" -%}
{%- assign html_proofer_attr = " data-proofer-ignore" -%}
{%- endif -%}

{% if webmentions.size > 0 %}
<aside class="webmentions"{{ html_proofer_attr }}{% unless webmention_types=="" %} data-webmention-types="{{ webmention_types }}"{% endunless %}>
  <hr>
  <h2>Web mentions</h2>
  <ol class="conversation webmentions--list">
    {% for webmention in webmentions %}
        {% if webmention.type == "reply" or webmention.type == "post" %}

            <li id="webmention-{{ webmention.id }}" class="p-comment conversation--item {% if webmention.author.name == 'John Peart' %}from-me{% else %}from-them{% endif %} webmention--{{ webmention.type }}">
                <article class="conversation--item--reply webmention webmention--{{ webmention.type }}">
                    <div class="conversation--item--author">
                        {% if webmention.pubdate %}
                            On <time datetime="{{ webmention.pubdate | date: '%FT%T%:z' }}">{{ webmention.pubdate | date: '%d %B %Y' }}</time>,
                        {% endif %}
                        {% if webmention.author %}
                            <a href="{%- if webmention.author.name == 'John Peart' -%}{{ site.url }}{%- else -%}{{ webmention.author.url }}{%- endif -%}" rel="nofollow">
                                <strong>{{ webmention.author.name }}</strong>
                            </a>
                        {% else %}
                            someone
                        {% endif %}
                        {% if webmention.raw.source %}
                          <a href="{{ webmention.raw.source }}" rel="nofollow">replied</a>
                        {% else %}
                          replied
                        {% endif %}
                    </div>
                    <div class="conversation--item--content">
                        {% if webmention.content %}
                            {{ webmention.content }}
                        {% else %}
                            {{ webmention.title }}
                        {% endif %}
                    </div>
                </article>
            </li>

        {% elsif webmention.type == "repost" or webmention.type == "like" or webmention.type == "bookmark" %}

            {% if webmention.author %}
            <li id="webmention-{{ webmention.id }}" class="p-comment conversation--item webmention--{{ webmention.type }}">
                <article class="conversation--item--interaction webmention webmention--{{ webmention.type }}">
                    <div class="conversation--item--interaction--content">
                        <p>
                            <span class="interaction-icon {{ webmention.type }}"></span>
                            <a href="{{ webmention.author.url }}" rel="nofollow">{{ webmention.author.name }}</a> {% if webmention.raw.source %}<a class="u-url" href="{{ webmention.raw.source }}" rel="nofollow">{% endif %}{% if webmention.type == "repost" %}shared{% elsif webmention.type == "like" %}liked{% elsif webmention.type == "bookmark" -%}bookmarked{% endif %}{% if webmention.raw.source %}</a>{% endif %} this post{% if webmention.pubdate %} on <time class="webmention--pubdate" datetime="{{ webmention.pubdate | date: '%FT%T%:z' }}">{{ webmention.pubdate | date: '%d %B %Y' }}</time>{% endif %}
                        </p>
                    </div>
                </article>
            </li>
            {% endif %}

        {% endif %}
    {% endfor %}
  </ol>
</aside>
{% endif %}
